<div th:replace="~{/back_end/include/include_top}" xmlns="http://www.w3.org/1999/html"></div>

  <title>活動場次編輯 </title>

  <style>

  </style>
</head>
<body><div th:replace="~{/back_end/include/include_body}"></div>
<div class="unique">
  <div>
    <h2 class="hc-2">編輯活動場次&nbsp;<span th:text="${sessionVO.activitySessionId}"></span></h2>
  </div>


<div >

  <form th:action="@{update}" method="post" th:object="${sessionVO}" enctype="multipart/form-data">

<input type="text" hidden th:value="${sessionVO.activitySessionId}" name="activitySessionId">
    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">活動名稱 <span class="require_text">(必填)</span></h5>
      </div>
      <select class="selectric2 required-field" th:field="*{itemVO.activityId}" required>
        <option value="">請選擇</option>
        <option th:each="itemVO : ${itemListData2}" th:value="${itemVO.activityId}" th:text="${itemVO.activityName}" />
      </select>
      <div class="error2" id="activitySelectError" >活動名稱必須選填喔&nbsp;<i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i></div>
<!--      <div th:if="${#fields.hasErrors('itemVO.activityId')}" class="error" id="itemVO.activityId.errors">-->
<!--        <span th:errors="*{itemVO.activityId}" ></span>-->
<!--        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>-->
<!--      </div>-->

    </div>
    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">場次日期 <span class="require_text">(必填)</span></h5>
      </div>
      <input type="date" class="form_element6" th:field="*{activityDate}"  onclick="hideContent('activityDate.errors');" />
      <div th:if="${#fields.hasErrors('activityDate')}" class="error" id="activityDate.errors">
        <span th:errors="*{activityDate}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>


      <div class="mb-4">
        <div class="mb-4">
          <h5 class="f-w">場次時段</h5>
        </div>
        <th:block th:each="timePeriod, iterStat : ${timePeriods}">
        <input type="time" class="timeBlock2" th:name="'timePeriod' + ${iterStat.count}" th:value="${timePeriod.timePeriod}" />
        </th:block>
      </div>


    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">活動時長 </h5>
      </div>
      <input type="text" class="form_element7 nt-u2" th:field="*{duration}"  onclick="hideContent('duration.errors');" />
      <span class="nt-u2 f-z">&nbsp;小時</span>
      <div th:if="${#fields.hasErrors('duration')}" class="error" id="duration.errors">
        <span th:errors="*{duration}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>
    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">開始報名日期 <span class="require_text">(必填)</span></h5>
      </div>
      <input type="datetime-local" class="form_element6 start" th:field="*{enrollStarted}"  onclick="hideContent('enrollStarted.errors');" />
      <div th:if="${#fields.hasErrors('enrollStarted')}" class="error" id="enrollStarted.errors">
        <span th:errors="*{enrollStarted}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>

    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">結束報名日期 <span class="require_text">(必填)</span></h5>
      </div>
      <input type="datetime-local" class="form_element6 end" th:field="*{enrollEnd}"  onclick="hideContent('enrollEnd.errors');" />
      <div th:if="${#fields.hasErrors('enrollEnd')}" class="error" id="enrollEnd.errors">
        <span th:errors="*{enrollEnd}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>
    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">活動地點<span class="require_text">(必填)</span> </h5>
      </div>
      <input type="text" class="form_element" th:field="*{activityLocation}"  onclick="hideContent('activityLocation.errors');" />
      <div th:if="${#fields.hasErrors('activityLocation')}" class="error" id="activityLocation.errors">
        <span th:errors="*{activityLocation}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>
    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">活動人數上限 <span class="require_text">(必填)</span></h5>
      </div>
      <input type="text" class="form_element7 nt-u2" th:field="*{activityMaxPart}"  onclick="hideContent('activityMaxPart.errors');" />
      <span class="nt-u2 f-z">&nbsp;位</span>
      <div th:if="${#fields.hasErrors('activityMaxPart')}" class="error" id="activityMaxPart.errors">
        <span th:errors="*{activityMaxPart}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>
    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">活動人數下限 <span class="require_text">(必填)</span></h5>
      </div>
      <input type="text" class="form_element7 nt-u2" th:field="*{activityMinPart}"  onclick="hideContent('activityMinPart.errors');" />
      <span class="nt-u2 f-z">&nbsp;位</span>
      <div th:if="${#fields.hasErrors('activityMinPart')}" class="error" id="activityMinPart.errors">
        <span th:errors="*{activityMinPart}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>
    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">報名總數<span class="require_text">(必填)</span> </h5>
      </div>
      <input type="text" class="form_element7 nt-u2" th:field="*{enrollTotal}"  onclick="hideContent('enrollTotal.errors');" />
      <span class="nt-u2 f-z">&nbsp;位</span>
      <div th:if="${#fields.hasErrors('enrollTotal')}" class="error" id="enrollTotal.errors">
        <span th:errors="*{enrollTotal}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>

    <div class="mb-4">
      <div class="mb-4">
        <h5 class="f-w">活動場次狀態 <span class="require_text">(必填)</span></h5>
      </div>
      <select class="selectric2 " th:field="*{activitySessionState}" >
        <option value="">請選擇</option>
        <option value="0">正常舉辦</option>
        <option value="1">取消</option>
        <option value="2">延期</option>
      </select>
      <div th:if="${#fields.hasErrors('activitySessionState')}" class="error" id="activitySessionState.errors">
        <span th:errors="*{activitySessionState}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>
    <div class="mb-3">
      <div class="mb-4">
        <h5 class="f-w">備註 </h5>
      </div>
      <textarea  class="textarea_element" th:field="*{activityNote}" onclick="hideContent('activityNote.errors');" /></textarea>
      <div  th:if="${#fields.hasErrors('activityNote')}"  class="error" id="activityNote.errors">
        <span th:errors="*{activityNote}" ></span>
        <i class="fa-solid fa-circle-exclamation" style="color: #dc3545;"></i>
      </div>
    </div>

    <br>
    <div>
      <div class="btn_area">

        <button type="button" class="btn btn-secondary cu-2"
                onclick="window.location.href='/session/listAllSession'">返回
        </button>
        <button type="submit" id="submit" class=" btn btn-outline-success2 cu-2"> 編輯完成</button>
      </div>

    </div>
  </form>
</div>
</div>

<!-- JavaScript part -->
<script type="text/javascript">
  //清除提示信息
  function hideContent(d) {
    document.getElementById(d).style.display = "none";
  }


  var startInput = document.querySelector(".start");
  var endInput = document.querySelector(".end");

  // 輸入好開始報名日期以後，設定结束報名日期可以選的日期為開始報名日期的後一天
  startInput.addEventListener("change", function() {
    //獲取開始報名時間的值
    var enrollStartedValue = new Date(this.value);

    // 計算结束報名日期為開始報名日期的後一天
    var enrollEndedValue = new Date(enrollStartedValue);
    enrollEndedValue.setDate(enrollStartedValue.getDate() + 1);

    // 结束報名日期的最小值設置为開始報名日期的後一天
    endInput.min = enrollEndedValue.toISOString().slice(0, 16);
  });

  $(document).ready(function () {
    $('#submit').click(function (event) {
      let isValid = true;
      const requiredFields = $('.required-field');
      const errorElement = $('#activitySelectError');

      requiredFields.each(function () {
        if ($(this).val() === '') {
          isValid = false;
          errorElement.show();
          $(this).focus();
          return false; // 退出循环
        } else {
          errorElement.hide();
        }
      });

      if (!isValid) {
        event.preventDefault(); // 防止提交
      }
    });

    $('.required-field').on('input', function () {
      const errorElement = $('#activitySelectError');
      if ($(this).val() !== '') {
        errorElement.hide();
      }
    });
  });

</script>
<div th:replace="~{/back_end/include/include_bottom}"></div>