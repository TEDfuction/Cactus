<div th:replace="~{/front_end/product/include_top}"></div>


<style>

	.cartTable th,td{
		text-align:center;
	}
	
	div.total-price{
		margin-left:1050px;
	}
	
	button.submit_order{
		margin-left:15px;
		font-size:1.3rem;
	}
	
	button.backToCart{
		margin-left:950px;
		font-size:1.3rem;
	}
	
	h3.title{
		margin-left:50px;
		color:#a57f5b;
	}
	
	.checkout-form{
		font-size:1.2rem;
	}
	
	.payInfo-inputs label {
		margin-left:60px;
	}
	
	.payInfo-inputs input {
		margin-left:10px;
	}
	
	input.submit_order{
		font-size:1.3rem;
		border:2px solid black;
		width:115px;
		height:37.2px;
		padding:1px 6px 1px 6px;
		margin-left:5px;
	}
	
	input#cart-total{
		font-size:1rem;
		border:none;
		width:40px;
	}

</style>
    
</head>

<body>



    <!-- Spinner Start  Lodding畫面-->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border position-relative text-primary" style="width: 6rem; height: 6rem;" role="status"></div>
        <img class="position-absolute top-50 start-50 translate-middle" th:src="@{/img/front_end/activity/icons/icon-12.png}" alt="Icon">
    </div>
    <!-- Spinner End -->
  

    <!-- Topbar Start -->
    <div class="container-fluid green-bg p-0 wow fadeIn sticky-top" data-wow-delay="0.1s" style="visibility: visible; animation-delay:0.2s; animation-name: fadeIn;">
        <div class="row gx-0 d-none d-lg-flex">
        
            <div class="col-lg-7 px-5 text-start">
                <!-- <div class="h-100 d-inline-flex align-items-center py-3 me-3"> -->
                    <!-- <a class="text-body px-2" href="tel:+0123456789"><i class="fa fa-phone-alt text-white me-2"></i>+012 345 6789</a>
                    <a class="text-body px-2" href="mailto:info@example.com"><i class="fa fa-envelope-open text-gold me-2"></i>info@example.com</a> -->
                <!-- </div> -->
            </div>
            
            <div class="col-lg-5 px-2-5 text-end">
                <div class="h-100 d-inline-flex align-items-center py-3 me-2">
                    <a class="text-white px-2 " href=""><i class="fa fa-home fa-lg icon-size"></i>&nbsp;&nbsp;首頁 ｜</a>
                    <a class="text-white px-2" id="cartLink" th:href="@{/shopCart/shopCart}">購物車 ｜</a>
                    <a class="text-white px-2" id="memberCenterLink" th:href="@{/member/memberOnlyWeb}">會員中心 ｜</a>
                    <a class="text-white px-2" th:href="@{/member/memberLogin}">加入會員</a>
                    
                </div>  
            </div>
            
        </div>
    </div>
   


<!-- -------------------------------------------------------------------- -->
<h3 class="title">--請確認以下資訊--</h3>

<div style="margin-top: 20px;"></div>
    
	<div class="accordion-item" style="border-radius: 0.5rem;">
        
        <h2 class="accordion-header">
          <button class="accordion-button " style="font-size: 25px;" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="false" aria-controls="panelsStayOpen-collapseOne">
            購物車清單
          </button>
        </h2>
        
 <form method="post" th:action="@{/shopCart/checkoutOrder}">
        
        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show">


			<div class="cart-container">
			    <table class="cartTable" width="100%" style="table-layout:fixed">
			        <thead>
			        <tr>
			            <th>商品編號</th>
			            <th>商品名稱</th>
			            <th>數量</th>
			            <th>單價</th>
			            <th>總價</th>
			        </tr>
			        </thead>
			        <tbody id="tableBody">
			        <!-- 從AJAX動態新增 -->
			
			        </tbody>
			    </table>
			    
			    <hr>
			    
			    <div class="total-price">
			        <span>訂單總價:$ <input type=text id="cart-total" name="productTotal" readonly/></span>
			    </div>
			    
			    
			</div>
		</div>
	</div>
	
	

<div style="margin-top: 20px;"></div>
    
	<div class="accordion-item" style="border-radius: 0.5rem;">
        
        <h2 class="accordion-header">
          <button class="accordion-button " style="font-size: 25px;" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
            消費者明細
          </button>
        </h2>
                
        <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse show">

			<div class="checkout-form">
			    <div class="payInfo">
			        <div class="payInfo-inputs">
			        	<br>
			            <label for="name">姓名:</label>
			            <input type="text" id="name" name="name" th:value="${memberVO.memberName}">
			            <br>
			            <br>
			            <label for="email">信箱:</label>
			            <input type="text" id="email" name="email" th:value="${session.account}">
			            <br>
			            <br>
			            <label for="phone">電話:</label>
			            <input type="tel" id="phone" name="phone" th:value="${memberVO.phone}">
			            <br>
			            <br>
			            <label for="address">地址:</label>
			            <input type="text" id="address" name="address" th:value="${memberVO.address}">
			            <br>
			            <br>
			        </div>
			    </div>
			
			</div>
		</div>
	</div>
	
	<br>
	
	<button class="backToCart" onclick="window.location.href='/shopCart/shopCart'">返回購物車</button>
	
	<input type="submit" class="submit_order" value="確認下單"/>
	
</form>


 <div th:replace="~{/front_end/product/include_footer}"></div>




<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<script>
	
	
	
	const cartTotalElement = document.getElementById('cart-total');
	
	function getShopCart() {
	    $.ajax({
	        url: '/shopCart/shopCartByMember',
	        type: 'GET',
	        success: function (response) {
	            // 在此從後端取得處理成功回應的購物車資料  List<DetailDTO> list
	//             console.log(response);
	            if (response != null) {
	                // 迭代取出物件  變成
	                const tableBody = document.getElementById("tableBody");
	                let html = "";
	
	                response.forEach(item => {
	                    html += `<tr>
	                                    <td>${item.productId}</td>
	                                    <td>${item.productName}</td>
	                                    <td>${item.quantity}</td>
	                                    <td>$${item.price}</td>
	                                    <td class="item-total">$${item.quantity * item.price}</td>
	                                  </tr>`;
	                });
	
	                tableBody.innerHTML = html;
	
	                updateCartTotal();
	                
	            } else {
	                alert("尚未登入會員，請登入");
	                window.location.href = '/front_end/member/memberLogin';
	            }
	        }
	        ,
	        error: function (xhr, status, error) {
	            // 在此處理錯誤
	            console.error(error);
	        }
	    });
	}
	
	
	
	getShopCart();
	
	
	
// 	$('.submit_order').on('click', function() {
		
// 		swal({
// 			  text:"確認要下單嗎?",
// 			  icon: "info",
// 			  buttons: {
// 			      cancel: {
// 				        text: "取消",
// 				        visible: true
// 				      },
// 				      confirm: {
// 				        text: "確認",
// 				        visible: true
// 				      }
// 				    }
// 			})
// 			.then(function(confirm){
// 				if(confirm){
// 					const cartTotalElement = document.getElementById('cart-total');
// 			        var totalPrice = parseInt(cartTotalElement.textContent.replace('$', ''), 10);
// 			        var name = $('#name').val();
// 			        var email = $('#email').val();
// 			        var phone = $('#phone').val();
// 			        var address = $('#address').val();
// 			    // 獲取要發送的數據	
// 			    var data = {
// 			    	productTotal:totalPrice,
// 			        name:name,
// 			        email:email,
// 			        phone:phone,
// 			        address:address,
// 			    };
// 	// 		    console.log(data);
	
// 			    // 發送AJAX請求
// 			    $.ajax({
// 			        url: '/shopCart/checkoutOrder',
// 			        type: 'POST',
// 			        data: JSON.stringify(data),
// 			        contentType: 'application/json',
// 			        success: function(response) {
// 			            // 請求成功，可以在這裡處理後續操作或顯示成功訊息
// 	// 		            console.log(response);
// 			        },error: function(xhr, status, error) {
// 			            // 請求失敗，可以在這裡處理錯誤或顯示錯誤訊息
// 			            console.error('請求失敗。狀態碼：' + xhr.status);
// 			        }
// 			    });			
// 			}else{
// 				console.log("NO");
// 					}
// 				})
		
	   
// 	});
	
	
	
	function updateCartTotal() {
	    const itemTotalElements = document.querySelectorAll('.item-total');
	    let cartTotal = 0;
	    itemTotalElements.forEach((itemTotalElement) => {
	        const itemTotal = parseFloat(itemTotalElement.textContent.replace('$', ''));
	        cartTotal += itemTotal;
	//         console.log(itemTotal);
	//         console.log(cartTotal);
	    });
	    cartTotalElement.value =  cartTotal;
	}


</script>

<div th:replace="~{/front_end/product/include_bottom}"></div>